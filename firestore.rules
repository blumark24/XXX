rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // =========================================
    // ğŸ‘¤ USERS COLLECTION
    // =========================================
    match /users/{userId} {

      // Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· ÙŠÙ…ÙƒÙ†Ù‡ Ù‚Ø±Ø§Ø¡Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØªØ¹Ø¯ÙŠÙ„Ù‡Ù…
      allow read, write: if
        request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "admin";

      // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ ÙŠØ³ØªØ·ÙŠØ¹ Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ÙÙ‚Ø·
      allow read: if
        request.auth != null &&
        request.auth.uid == userId;
    }

    // =========================================
    // ğŸ“‹ OBSERVATIONS COLLECTION
    // =========================================
    match /observations/{docId} {

      // âœ… ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¬Ù…ÙŠØ¹ (Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙ‚Ø·) Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
      allow read: if request.auth != null;

      // ğŸ‘· Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ (inspector) ÙŠØ³ØªØ·ÙŠØ¹ ÙÙ‚Ø· "Ø§Ù„Ø¥Ø¶Ø§ÙØ©" ÙˆÙ„ÙŠØ³ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø­Ø°Ù
      allow create: if
        request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "inspector";

      // ğŸ—ï¸ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ (contractor) ÙŠØ³ØªØ·ÙŠØ¹ ÙÙ‚Ø· "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©"
      allow update: if
        request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "contractor";

      // ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ± (admin) ÙŠØ³ØªØ·ÙŠØ¹ ÙƒÙ„ Ø´ÙŠØ¡
      allow create, update, delete: if
        request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "admin";
    }
  }
}
